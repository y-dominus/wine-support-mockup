<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™ºæ³¨ç®¡ç† | ãƒ¯ã‚¤ã‚µãƒ - SommiaãŒã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ¯ã‚¤ãƒ³ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="icon" href="../../assets/images/favicon.ico">
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/layout.css">
    <link rel="stylesheet" href="../../css/components/buttons.css">
    <link rel="stylesheet" href="../../css/components/ai_chat.css">
    <link rel="stylesheet" href="../../css/components/forms.css">
    <link rel="stylesheet" href="../../css/components/tables.css">
    <link rel="stylesheet" href="../../css/components/cards.css">
    <link rel="stylesheet" href="../../css/components/wine-bottles.css">
    <script defer src="../../js/main.js"></script>
    <script defer src="../../js/common_parts.js"></script>
    <script defer src="../../js/ai_simulator.js"></script>
    <script defer src="../../js/utils.js"></script>
    <script defer src="../../js/components/notifications.js"></script>
    <style>
        /* è£œå……ç™ºæ³¨ãƒšãƒ¼ã‚¸ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .page-header {
            margin-bottom: var(--spacing-lg);
        }
        
        .page-title-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }
        
        .page-actions {
            display: flex;
            gap: var(--spacing-md);
        }
        
        .page-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: var(--spacing-lg);
        }
        
        .order-content {
            background-color: var(--white);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-sm);
            padding: var(--spacing-lg);
        }
        
        .order-sidebar {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }
        
        .order-summary-card {
            background-color: var(--light-gray);
            border-radius: var(--border-radius-md);
            margin-bottom: var(--spacing-lg);
            border: 1px solid var(--medium-gray);
        }
        
        .card-header {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--medium-gray);
            background-color: rgba(136, 69, 145, 0.1);
        }
        
        .card-title {
            margin: 0;
            font-size: var(--font-size-lg);
            color: var(--secondary-color);
        }
        
        .card-body {
            padding: var(--spacing-md);
        }
        
        .order-summary {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-md);
        }
        
        .summary-item {
            display: flex;
            flex-direction: column;
        }
        
        .summary-label {
            font-size: var(--font-size-sm);
            color: var(--dark-gray);
            margin-bottom: 4px;
        }
        
        .summary-value {
            font-size: var(--font-size-lg);
            font-weight: bold;
            color: var(--black);
        }
        
        .section-title {
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-xs);
            border-bottom: 2px solid var(--medium-gray);
            color: var(--dark-gray);
        }
        
        .order-items-section, 
        .order-details-section {
            margin-bottom: var(--spacing-xl);
        }
        
        .order-table-container {
            margin-bottom: var(--spacing-md);
            overflow-x: auto;
        }
        
        .wine-name-cell {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .ai-suggestion-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: linear-gradient(135deg, #884591, #B95A9D);
            color: white;
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 8px;
            margin-left: var(--spacing-xs);
        }
        
        .suggestion-reason {
            font-size: var(--font-size-xs);
            color: #884591;
            font-weight: 500;
            margin-top: 2px;
        }
        
        .wine-info {
            display: flex;
            flex-direction: column;
        }
        
        .wine-name {
            font-weight: bold;
        }
        
        .wine-details {
            font-size: var(--font-size-sm);
            color: var(--dark-gray);
        }
        
        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: var(--font-size-xs);
            font-weight: bold;
        }
        
        .status-badge.danger {
            background-color: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
        
        .status-badge.warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: #fd7e14;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            width: 100px;
        }
        
        .quantity-btn {
            width: 28px;
            height: 28px;
            border: 1px solid var(--medium-gray);
            background-color: var(--white);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .quantity-input {
            width: 40px;
            height: 28px;
            border: 1px solid var(--medium-gray);
            text-align: center;
            margin: 0 4px;
        }
        
        .order-actions {
            margin-top: var(--spacing-md);
            display: flex;
            justify-content: flex-end;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }
        
        .sidebar-card {
            background-color: var(--white);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--medium-gray);
            margin-bottom: var(--spacing-md);
        }
        
        .last-order-info {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            font-size: var(--font-size-sm);
        }
        
        .info-label {
            color: var(--dark-gray);
        }
        
        .info-value {
            font-weight: bold;
        }
        
        .link-action {
            margin-top: var(--spacing-sm);
            text-align: center;
        }
        
        .recommended-wines {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }
        
        .recommended-wine {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .wine-bottle-small {
            width: 16px;
            height: 40px;
            border-radius: 8px 8px 4px 4px;
            position: relative;
        }
        
        .wine-bottle-small.red {
            background-color: rgba(128, 0, 0, 0.7);
        }
        
        .wine-bottle-small.white {
            background-color: rgba(255, 223, 0, 0.3);
        }
        
        .wine-bottle-small.sparkling {
            background-color: rgba(255, 215, 0, 0.3);
        }
        
        .recommended-wine-info {
            flex: 1;
            font-size: var(--font-size-sm);
        }
        
        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: var(--white);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-lg);
            width: 90%;
            max-width: 500px;
            animation: modalFadeIn 0.3s;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--medium-gray);
        }
        
        .modal-title {
            margin: 0;
            color: var(--secondary-color);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--dark-gray);
        }
        
        .modal-body {
            padding: var(--spacing-lg);
        }
        
        .modal-footer {
            padding: var(--spacing-md);
            border-top: 1px solid var(--medium-gray);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-md);
        }
        
        .confirm-order-summary {
            background-color: var(--light-gray);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-sm);
            margin-top: var(--spacing-md);
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-sm);
        }
        
        .order-complete-message {
            text-align: center;
        }
        
        .complete-icon {
            width: 60px;
            height: 60px;
            background-color: var(--primary-color);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin: 0 auto var(--spacing-md);
        }
        
        /* ãƒ¯ã‚¤ãƒ³é¸æŠãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¹ã‚¿ã‚¤ãƒ« */
        .wine-selection-message {
            background-color: rgba(255, 77, 0, 0.1);
            border-left: 3px solid var(--primary-color);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: 0 var(--border-radius-sm) var(--border-radius-sm) 0;
            transition: opacity 0.5s ease;
        }
        
        .wine-selection-message p {
            margin: 0;
            color: var(--dark-gray);
        }
        
        .wine-selection-message strong {
            color: var(--primary-color);
        }
        
        /* ãƒ¯ã‚¤ãƒ³æ¤œç´¢ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .search-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }
        
        .search-modal-content {
            background-color: var(--white);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-lg);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s;
        }
        
        .search-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--medium-gray);
            position: sticky;
            top: 0;
            background-color: var(--white);
            z-index: 10;
        }
        
        .search-modal-title {
            margin: 0;
            color: var(--secondary-color);
        }
        
        .search-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--dark-gray);
        }
        
        .search-modal-body {
            padding: var(--spacing-lg);
        }
        
        .search-form {
            margin-bottom: var(--spacing-lg);
        }
        
        .search-filters {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        
        .search-input-container {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }
        
        .search-input {
            flex: 1;
        }
        
        .search-results {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .search-result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm);
            border-bottom: 1px solid var(--light-gray);
        }
        
        .search-result-item:last-child {
            border-bottom: none;
        }
        
        .search-result-info {
            flex: 1;
        }
        
        .search-result-name {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .search-result-details {
            font-size: var(--font-size-sm);
            color: var(--dark-gray);
        }
        
        .search-result-actions {
            display: flex;
            gap: var(--spacing-sm);
        }
        
        .wine-thumbnail {
            width: 12px;
            height: 30px;
            border-radius: 6px 6px 2px 2px;
            margin-right: var(--spacing-xs);
        }
        
        .wine-thumbnail.red {
            background: linear-gradient(135deg, #8B0000, #DC143C);
        }
        
        .wine-thumbnail.white {
            background: linear-gradient(135deg, #FFF8DC, #F0E68C);
        }
        
        .wine-thumbnail.sparkling {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }
        
        .wine-thumbnail.rose {
            background: linear-gradient(135deg, #FF69B4, #FFB6C1);
        }
        @media (max-width: 992px) {
            .page-container {
                grid-template-columns: 1fr;
            }
            
            .order-summary {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .order-summary {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>
    
    <main>
        <div class="container">
            <div class="page-header">
                <h1 class="page-title">ç™ºæ³¨ç®¡ç†</h1>
                <div class="page-actions">
                    <button class="btn btn-outline-primary" id="toggle-view-btn">ğŸ¤– AIææ¡ˆã®ã¿è¡¨ç¤º</button>
                    <button class="btn btn-primary" id="search-wine-btn">ãƒ¯ã‚¤ãƒ³ã‚’æ¤œç´¢ãƒ»è¿½åŠ </button>
                </div>
                <div class="ai-message-container">
                    <div id="ai-message-area" class="ai-message ai-message-dismissible">
                        <img src="../../sommia.png" alt="Sommia - ã‚½ãƒ ãƒªã‚¨AI" class="ai-avatar-small">
                        <span class="ai-text">ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã—ãŸã„ãƒ¯ã‚¤ãƒ³ã‚’è‡ªå‹•ã§ææ¡ˆã—ã¾ã—ãŸï¼æ•°é‡ã‚’èª¿æ•´ã—ãŸã‚Šã€æ–°ã—ã„ãƒ¯ã‚¤ãƒ³ã‚’è¿½åŠ ã—ãŸã‚Šã§ãã¾ã™ã€‚</span>
                        <button class="ai-close" onclick="dismissAiMessage(this)" title="é–‰ã˜ã‚‹">&times;</button>
                    </div>
                </div>
            </div>
            
            <div class="page-container">
                <div class="order-content">
                    <div class="order-summary-card">
                        <div class="card-header">
                            <h2 class="card-title">ã‚«ãƒ¼ãƒˆè¿½åŠ å†…å®¹ã‚µãƒãƒªãƒ¼</h2>
                        </div>
                        <div class="card-body">
                            <div class="order-summary">
                                <div class="summary-item">
                                    <span class="summary-label">è¿½åŠ å•†å“æ•°</span>
                                    <span class="summary-value" id="total-items">3</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">åˆè¨ˆæœ¬æ•°</span>
                                    <span class="summary-value" id="total-bottles">12</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">åˆè¨ˆé‡‘é¡</span>
                                    <span class="summary-value" id="total-amount">Â¥106,800</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">ç´æœŸ</span>
                                    <span class="summary-value">3å–¶æ¥­æ—¥ä»¥å†…</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="order-items-section">
                        <h2 class="section-title">ã‚«ãƒ¼ãƒˆè¿½åŠ å•†å“ä¸€è¦§</h2>
                        <div class="order-table-container">
                            <table class="data-table order-table">
                                <thead>
                                    <tr>
                                        <th>å•†å“å</th>
                                        <th>ç¨®é¡</th>
                                        <th>ç”Ÿç”£åœ°</th>
                                        <th>åœ¨åº«çŠ¶æ³</th>
                                        <th>ä¾¡æ ¼/æœ¬</th>
                                        <th>æ•°é‡</th>
                                        <th>å°è¨ˆ</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <div class="wine-name-cell">
                                                <div class="wine-bottle red"></div>
                                                <div class="wine-info">
                                                    <div class="wine-name">
                                                        ã‚­ãƒ£ãƒ³ãƒ†ã‚£ ã‚¯ãƒ©ã‚·ã‚³ ãƒªã‚¼ãƒ«ãƒ´ã‚¡
                                                        <span class="ai-suggestion-badge">ğŸ¤– AIææ¡ˆ</span>
                                                    </div>
                                                    <div class="wine-details">2018å¹´, 750ml</div>
                                                    <div class="suggestion-reason">äººæ°—å•†å“ã§æ®‹ã‚Šåƒ…ã‹</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>èµ¤ãƒ¯ã‚¤ãƒ³</td>
                                        <td>ã‚¤ã‚¿ãƒªã‚¢</td>
                                        <td>
                                            <span class="status-badge danger">æ®‹ã‚Š2æœ¬</span>
                                        </td>
                                        <td>Â¥8,800</td>
                                        <td>
                                            <div class="quantity-control">
                                                <button class="quantity-btn minus" data-id="1">-</button>
                                                <input type="number" class="quantity-input" value="6" min="1" max="24" data-id="1">
                                                <button class="quantity-btn plus" data-id="1">+</button>
                                            </div>
                                        </td>
                                        <td>Â¥52,800</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-danger delete-item" data-id="1">å‰Šé™¤</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="wine-name-cell">
                                                <div class="wine-bottle white"></div>
                                                <div class="wine-info">
                                                    <div class="wine-name">ã‚½ãƒ¼ãƒ´ã‚£ãƒ‹ãƒ¨ãƒ³ãƒ»ãƒ–ãƒ©ãƒ³</div>
                                                    <div class="wine-details">2022å¹´, 750ml</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>ç™½ãƒ¯ã‚¤ãƒ³</td>
                                        <td>ãƒ‹ãƒ¥ãƒ¼ã‚¸ãƒ¼ãƒ©ãƒ³ãƒ‰</td>
                                        <td>
                                            <span class="status-badge danger">æ®‹ã‚Š1æœ¬</span>
                                        </td>
                                        <td>Â¥7,000</td>
                                        <td>
                                            <div class="quantity-control">
                                                <button class="quantity-btn minus" data-id="2">-</button>
                                                <input type="number" class="quantity-input" value="4" min="1" max="24" data-id="2">
                                                <button class="quantity-btn plus" data-id="2">+</button>
                                            </div>
                                        </td>
                                        <td>Â¥28,000</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-danger delete-item" data-id="2">å‰Šé™¤</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="wine-name-cell">
                                                <div class="wine-bottle red"></div>
                                                <div class="wine-info">
                                                    <div class="wine-name">
                                                        ãƒ¡ãƒ«ãƒ­ãƒ¼
                                                        <span class="ai-suggestion-badge">ğŸ¤– AIææ¡ˆ</span>
                                                    </div>
                                                    <div class="wine-details">2020å¹´, 750ml</div>
                                                    <div class="suggestion-reason">ç¨‹ã‚ˆã„ãƒšãƒ¼ã‚¹ã§å£²ã‚Œã¦ã„ã‚‹äººæ°—å•†å“</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>èµ¤ãƒ¯ã‚¤ãƒ³</td>
                                        <td>ãƒãƒª</td>
                                        <td>
                                            <span class="status-badge warning">æ®‹ã‚Š3æœ¬</span>
                                        </td>
                                        <td>Â¥6,500</td>
                                        <td>
                                            <div class="quantity-control">
                                                <button class="quantity-btn minus" data-id="3">-</button>
                                                <input type="number" class="quantity-input" value="4" min="1" max="24" data-id="3">
                                                <button class="quantity-btn plus" data-id="3">+</button>
                                            </div>
                                        </td>
                                        <td>Â¥26,000</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-danger delete-item" data-id="3">å‰Šé™¤</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="order-actions">
                            <a href="../my_cellar/my_cellar.html" class="btn btn-secondary">ä»–ã®ãƒ¯ã‚¤ãƒ³ã‚’è¿½åŠ </a>
                        </div>
                    </div>
                    
                    <div class="order-details-section">
                        <h2 class="section-title">ã‚«ãƒ¼ãƒˆè¿½åŠ è©³ç´°</h2>
                        <form id="order-form" class="order-form">
                            <div class="form-row">
                                <div class="form-col-6">
                                    <div class="form-group">
                                        <label for="delivery-date" class="form-label">å¸Œæœ›ç´æœŸ</label>
                                        <select id="delivery-date" name="delivery-date" class="form-select">
                                            <option value="default">æœ€çŸ­ç´æœŸï¼ˆ3å–¶æ¥­æ—¥ä»¥å†…ï¼‰</option>
                                            <option value="next-week">æ¥é€±ï¼ˆ5æœˆ27æ—¥ã€œ31æ—¥ï¼‰</option>
                                            <option value="two-weeks">2é€±é–“å¾Œï¼ˆ6æœˆ3æ—¥ã€œ7æ—¥ï¼‰</option>
                                            <option value="custom">æ—¥ä»˜æŒ‡å®š</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-col-6" id="custom-date-container" style="display: none;">
                                    <div class="form-group">
                                        <label for="custom-date" class="form-label">æŒ‡å®šæ—¥</label>
                                        <input type="date" id="custom-date" name="custom-date" class="form-input" min="2025-05-24">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="notes" class="form-label">å‚™è€ƒ</label>
                                <textarea id="notes" name="notes" class="form-textarea" placeholder="ç‰¹è¨˜äº‹é …ãŒã‚ã‚Œã°ã”è¨˜å…¥ãã ã•ã„"></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline-primary" id="save-draft">ä¸‹æ›¸ãä¿å­˜</button>
                                <button type="button" class="btn btn-primary" id="add-to-cart">ã‚«ãƒ¼ãƒˆã«è¿½åŠ </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="order-sidebar">
                    <div class="ai-prompt-box">
                        <div class="ai-prompt-title">
                            <img src="../../sommia.png" alt="Sommia" class="ai-avatar-inline">
                            Sommiaã‹ã‚‰ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
                        </div>
                        <div class="ai-prompt-content">
                            <p>ã‚­ãƒ£ãƒ³ãƒ†ã‚£ã¯äººæ°—ãŒé«˜ãã€6æœ¬ã®è£œå……ãŒãŠã™ã™ã‚ã§ã™ã€‚å…ˆé€±æœ«ã ã‘ã§3æœ¬å£²ã‚Œã¾ã—ãŸã€‚</p>
                            <p>ã¾ãŸã€å­£ç¯€ã®å¤‰ã‚ã‚Šç›®ãªã®ã§ã€ç™½ãƒ¯ã‚¤ãƒ³ã®åœ¨åº«ã‚’å°‘ã—å¢—ã‚„ã™ã¨è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ç‰¹ã«ã‚·ãƒ£ãƒ«ãƒ‰ãƒãŒä»Šæœˆã®ãŠã™ã™ã‚ã§ã™ã€‚</p>
                        </div>
                    </div>
                    
                    <div class="card sidebar-card">
                        <div class="card-header">
                            <h3 class="card-title">å‰å›ã®ç™ºæ³¨</h3>
                        </div>
                        <div class="card-body">
                            <div class="last-order-info">
                                <div class="info-item">
                                    <span class="info-label">ç™ºæ³¨æ—¥</span>
                                    <span class="info-value">2025å¹´5æœˆ8æ—¥</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">å•†å“æ•°</span>
                                    <span class="info-value">5ç¨®é¡</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">åˆè¨ˆæœ¬æ•°</span>
                                    <span class="info-value">16æœ¬</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">åˆè¨ˆé‡‘é¡</span>
                                    <span class="info-value">Â¥142,400</span>
                                </div>
                            </div>
                            <div class="link-action">
                                <a href="order_history.html" class="btn btn-link">ç™ºæ³¨å±¥æ­´ã‚’è¦‹ã‚‹</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card sidebar-card">
                        <div class="card-header">
                            <h3 class="card-title">ãŠã™ã™ã‚ãƒ¯ã‚¤ãƒ³</h3>
                        </div>
                        <div class="card-body">
                            <div class="recommended-wines">
                                <div class="recommended-wine">
                                    <div class="wine-bottle-small white"></div>
                                    <div class="recommended-wine-info">
                                        <div class="wine-name">ã‚·ãƒ£ãƒ«ãƒ‰ãƒ</div>
                                        <div class="wine-origin">ã‚«ãƒªãƒ•ã‚©ãƒ«ãƒ‹ã‚¢</div>
                                        <div class="wine-price">Â¥7,800/æœ¬</div>
                                    </div>
                                    <button class="btn btn-sm btn-outline-primary add-to-order-sidebar">è¿½åŠ </button>
                                </div>
                                <div class="recommended-wine">
                                    <div class="wine-bottle-small sparkling"></div>
                                    <div class="recommended-wine-info">
                                        <div class="wine-name">ãƒ—ãƒ­ã‚»ãƒƒã‚³</div>
                                        <div class="wine-origin">ã‚¤ã‚¿ãƒªã‚¢</div>
                                        <div class="wine-price">Â¥6,200/æœ¬</div>
                                    </div>
                                    <button class="btn btn-sm btn-outline-primary add-to-order-sidebar">è¿½åŠ </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- ãƒ¯ã‚¤ãƒ³æ¤œç´¢ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="search-modal" id="search-modal">
        <div class="search-modal-content">
            <div class="search-modal-header">
                <h3 class="search-modal-title">ãƒ¯ã‚¤ãƒ³ã‚’æ¤œç´¢ãƒ»è¿½åŠ </h3>
                <button class="search-modal-close">&times;</button>
            </div>
            <div class="search-modal-body">
                <div class="search-form">
                    <div class="search-filters">
                        <div class="form-group">
                            <label for="wine-type">ãƒ¯ã‚¤ãƒ³ã‚¿ã‚¤ãƒ—</label>
                            <select class="form-control" id="wine-type">
                                <option value="">ã™ã¹ã¦</option>
                                <option value="red">èµ¤ãƒ¯ã‚¤ãƒ³</option>
                                <option value="white">ç™½ãƒ¯ã‚¤ãƒ³</option>
                                <option value="sparkling">ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒªãƒ³ã‚°</option>
                                <option value="rose">ãƒ­ã‚¼</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="wine-region">ç”Ÿç”£åœ°</label>
                            <select class="form-control" id="wine-region">
                                <option value="">ã™ã¹ã¦</option>
                                <option value="france">ãƒ•ãƒ©ãƒ³ã‚¹</option>
                                <option value="italy">ã‚¤ã‚¿ãƒªã‚¢</option>
                                <option value="spain">ã‚¹ãƒšã‚¤ãƒ³</option>
                                <option value="chile">ãƒãƒª</option>
                                <option value="australia">ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢</option>
                                <option value="japan">æ—¥æœ¬</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="wine-price">ä¾¡æ ¼å¸¯</label>
                            <select class="form-control" id="wine-price">
                                <option value="">ã™ã¹ã¦</option>
                                <option value="under5000">ã€œï¿¥5,000</option>
                                <option value="5000-10000">ï¿¥5,000ã€œï¿¥10,000</option>
                                <option value="10000-20000">ï¿¥10,000ã€œï¿¥20,000</option>
                                <option value="over20000">ï¿¥20,000ã€œ</option>
                            </select>
                        </div>
                    </div>
                    <div class="search-input-container">
                        <input type="text" class="form-control search-input" placeholder="ãƒ¯ã‚¤ãƒ³åã€ç”Ÿç”£è€…åã€å“ç¨®åãªã©ã§æ¤œç´¢">
                        <button class="btn btn-primary" id="search-execute-btn">æ¤œç´¢</button>
                    </div>
                </div>
                
                <div class="search-results">
                    <div class="search-result-item">
                        <div class="search-result-info">
                            <div style="display: flex; align-items: center;">
                                <div class="wine-thumbnail red"></div>
                                <div>
                                    <div class="search-result-name">ãƒãƒ­ãƒ¼ãƒ­</div>
                                    <div class="search-result-details">èµ¤ãƒ¯ã‚¤ãƒ³ | ã‚¤ã‚¿ãƒªã‚¢ | 2017å¹´ | ï¿¥12,000</div>
                                </div>
                            </div>
                        </div>
                        <div class="search-result-actions">
                            <button class="btn btn-sm btn-outline-primary wine-detail-btn" data-wine-id="4">è©³ç´°</button>
                            <button class="btn btn-sm btn-primary add-to-order-btn" data-wine-id="4">ãƒªã‚¹ãƒˆã«è¿½åŠ </button>
                        </div>
                    </div>
                    <div class="search-result-item">
                        <div class="search-result-info">
                            <div style="display: flex; align-items: center;">
                                <div class="wine-thumbnail white"></div>
                                <div>
                                    <div class="search-result-name">ã‚·ãƒ£ãƒ–ãƒª ãƒ—ãƒ«ãƒŸã‚¨ãƒ»ã‚¯ãƒªãƒ¥</div>
                                    <div class="search-result-details">ç™½ãƒ¯ã‚¤ãƒ³ | ãƒ•ãƒ©ãƒ³ã‚¹ | 2020å¹´ | ï¿¥9,500</div>
                                </div>
                            </div>
                        </div>
                        <div class="search-result-actions">
                            <button class="btn btn-sm btn-outline-primary wine-detail-btn" data-wine-id="5">è©³ç´°</button>
                            <button class="btn btn-sm btn-primary add-to-order-btn" data-wine-id="5">ãƒªã‚¹ãƒˆã«è¿½åŠ </button>
                        </div>
                    </div>
                    <div class="search-result-item">
                        <div class="search-result-info">
                            <div style="display: flex; align-items: center;">
                                <div class="wine-thumbnail sparkling"></div>
                                <div>
                                    <div class="search-result-name">ã‚·ãƒ£ãƒ³ãƒ‘ãƒ¼ãƒ‹ãƒ¥ ãƒ–ãƒªãƒ¥ãƒƒãƒˆ</div>
                                    <div class="search-result-details">ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒªãƒ³ã‚° | ãƒ•ãƒ©ãƒ³ã‚¹ | NV | ï¿¥15,800</div>
                                </div>
                            </div>
                        </div>
                        <div class="search-result-actions">
                            <button class="btn btn-sm btn-outline-primary wine-detail-btn" data-wine-id="6">è©³ç´°</button>
                            <button class="btn btn-sm btn-primary add-to-order-btn" data-wine-id="6">ãƒªã‚¹ãƒˆã«è¿½åŠ </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="footer-placeholder"></div>
    
    <!-- ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="confirm-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ã‚«ãƒ¼ãƒˆã¸ã®è¿½åŠ ç¢ºèª</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>ä»¥ä¸‹ã®å†…å®¹ã§ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ</p>
                <div class="confirm-order-summary">
                    <div class="summary-item">
                        <span class="summary-label">å•†å“æ•°</span>
                        <span class="summary-value">3ç¨®é¡</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">åˆè¨ˆæœ¬æ•°</span>
                        <span class="summary-value">14æœ¬</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">åˆè¨ˆé‡‘é¡</span>
                        <span class="summary-value">Â¥106,800</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">å¸Œæœ›ç´æœŸ</span>
                        <span class="summary-value">æœ€çŸ­ç´æœŸï¼ˆ3å–¶æ¥­æ—¥ä»¥å†…ï¼‰</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-secondary modal-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn btn-primary" id="confirm-add-to-cart">ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã™ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- ã‚«ãƒ¼ãƒˆè¿½åŠ å®Œäº†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="complete-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸ</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="order-complete-message">
                    <div class="complete-icon">âœ“</div>
                    <p>é¸æŠã—ãŸãƒ¯ã‚¤ãƒ³ã‚’ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸã€‚</p>
                    <p>åˆè¨ˆ: <strong>3ç¨®é¡ 14æœ¬ ï¿¥106,800</strong></p>
                    <p>ã‚«ãƒ¼ãƒˆã§å†…å®¹ã‚’ç¢ºèªã—ã€ç™ºæ³¨æ‰‹ç¶šãã‚’è¡Œã£ã¦ãã ã•ã„ã€‚</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-secondary" onclick="window.location.href='../dashboard.html'">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸</button>
                <button class="btn btn-primary" onclick="window.location.href='../cart.html'">ã‚«ãƒ¼ãƒˆã‚’ç¢ºèª</button>
            </div>
        </div>
    </div>
    
    <script>
        // AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é–‰ã˜ã‚‹é–¢æ•°
        function dismissAiMessage(button) {
            const messageElement = button.closest('.ai-message-dismissible');
            if (messageElement) {
                messageElement.classList.add('dismissed');
                setTimeout(() => {
                    const container = messageElement.closest('.ai-message-container');
                    if (container) {
                        container.style.display = 'none';
                    }
                }, 300);
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // AI ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º
            try {
                if (typeof displayAiMessage === 'function') {
                    displayAiMessage('orders', 'replenishOrder', null, '#ai-message-area');
                }
            } catch (e) {
                console.error('AI message display error:', e);
            }
            
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‡¦ç†
            function handleUrlParams() {
                const urlParams = new URLSearchParams(window.location.search);
                const wineId = urlParams.get('wine_id');
                const wineName = urlParams.get('wine_name');
                
                if (wineId && wineName) {
                    // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚’å‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
                    console.log(`æŒ‡å®šã•ã‚ŒãŸãƒ¯ã‚¤ãƒ³: ${wineName} (ID: ${wineId})`);
                    
                    // å®Ÿé¨“çš„ãªå®Ÿè£…: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    const messageHTML = `
                        <div class="wine-selection-message">
                            <p><strong>${wineName}</strong> ã‚’ç™ºæ³¨ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸã€‚æ•°é‡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
                        </div>
                    `;
                    
                    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹è¦ç´ ã‚’é¸æŠ
                    const orderContent = document.querySelector('.order-content');
                    const firstChild = orderContent.firstChild;
                    
                    // ä¸€æ™‚çš„ãªè¦ç´ ã‚’ä½œæˆ
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = messageHTML;
                    
                    // è¦ç´ ã‚’æŒ¿å…¥
                    orderContent.insertBefore(tempDiv.firstChild, firstChild);
                    
                    // 5ç§’å¾Œã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éè¡¨ç¤ºã«ã™ã‚‹
                    setTimeout(() => {
                        const message = document.querySelector('.wine-selection-message');
                        if (message) {
                            message.style.opacity = '0';
                            setTimeout(() => message.remove(), 500);
                        }
                    }, 5000);
                }
            }
            
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‡¦ç†ã‚’å®Ÿè¡Œ
            handleUrlParams();
            
            // æ•°é‡å¤‰æ›´ãƒœã‚¿ãƒ³ã®å‡¦ç†
            const quantityButtons = document.querySelectorAll('.quantity-btn');
            quantityButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const itemId = this.dataset.id;
                    const input = document.querySelector(`.quantity-input[data-id="${itemId}"]`);
                    let value = parseInt(input.value);
                    
                    if (this.classList.contains('minus') && value > 1) {
                        value--;
                    } else if (this.classList.contains('plus') && value < 24) {
                        value++;
                    }
                    
                    input.value = value;
                    updateOrderTotals();
                });
            });
            
            // å‰Šé™¤ãƒœã‚¿ãƒ³ã®å‡¦ç†
            const deleteButtons = document.querySelectorAll('.delete-item');
            deleteButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const itemId = this.dataset.id;
                    const row = this.closest('tr');
                    
                    if (confirm('ã“ã®å•†å“ã‚’ã‚«ãƒ¼ãƒˆè¿½åŠ ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                        row.remove();
                        updateOrderTotals();
                    }
                });
            });
            
            // åˆè¨ˆé‡‘é¡ã®æ›´æ–°
            function updateOrderTotals() {
                const rows = document.querySelectorAll('.order-table tbody tr');
                let totalItems = rows.length;
                let totalBottles = 0;
                let totalAmount = 0;
                
                rows.forEach(row => {
                    const quantityInput = row.querySelector('.quantity-input');
                    const priceText = row.querySelector('td:nth-child(5)').textContent;
                    const quantity = parseInt(quantityInput.value);
                    const price = parseInt(priceText.replace('Â¥', '').replace(',', ''));
                    
                    totalBottles += quantity;
                    totalAmount += price * quantity;
                    
                    // å°è¨ˆã®æ›´æ–°
                    const subtotalCell = row.querySelector('td:nth-child(7)');
                    subtotalCell.textContent = `Â¥${(price * quantity).toLocaleString()}`;
                });
                
                // åˆè¨ˆã®æ›´æ–°
                document.getElementById('total-items').textContent = totalItems;
                document.getElementById('total-bottles').textContent = totalBottles;
                document.getElementById('total-amount').textContent = `Â¥${totalAmount.toLocaleString()}`;
            }
            
            // å¸Œæœ›ç´æœŸã®å¤‰æ›´å‡¦ç†
            const deliveryDateSelect = document.getElementById('delivery-date');
            const customDateContainer = document.getElementById('custom-date-container');
            
            deliveryDateSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customDateContainer.style.display = 'block';
                } else {
                    customDateContainer.style.display = 'none';
                }
            });
            
            // ã‚«ãƒ¼ãƒˆè¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡å‡¦ç†
            const orderForm = document.getElementById('order-form');
            const addToCartBtn = document.getElementById('add-to-cart');
            const confirmModal = document.getElementById('confirm-modal');
            const completeModal = document.getElementById('complete-modal');
            
            if (addToCartBtn) {
                addToCartBtn.addEventListener('click', function(event) {
                    event.preventDefault();
                    confirmModal.style.display = 'flex';
                });
            }
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
            const closeButtons = document.querySelectorAll('.modal-close, .modal-cancel');
            closeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    modal.style.display = 'none';
                });
            });
            
            // ã‚«ãƒ¼ãƒˆè¿½åŠ ç¢ºå®šãƒœã‚¿ãƒ³
            const confirmAddToCartButton = document.getElementById('confirm-add-to-cart');
            if (confirmAddToCartButton) {
                confirmAddToCartButton.addEventListener('click', function() {
                    confirmModal.style.display = 'none';
                    completeModal.style.display = 'flex';
                });
            }
            
            // ãƒ¯ã‚¤ãƒ³æ¤œç´¢ãƒ¢ãƒ¼ãƒ€ãƒ«ã®åˆ¶å¾¡
            const searchBtn = document.getElementById('search-wine-btn');
            const searchModal = document.getElementById('search-modal');
            const searchCloseBtn = document.querySelector('.search-modal-close');
            
            if (searchBtn && searchModal) {
                searchBtn.addEventListener('click', function() {
                    searchModal.style.display = 'flex';
                });
            }
            
            if (searchCloseBtn && searchModal) {
                searchCloseBtn.addEventListener('click', function() {
                    searchModal.style.display = 'none';
                });
            }
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            window.addEventListener('click', function(event) {
                if (event.target === searchModal) {
                    searchModal.style.display = 'none';
                }
            });
            
            // ç™ºæ³¨ãƒªã‚¹ãƒˆã¸ã®è¿½åŠ å‡¦ç†
            const addToOrderButtons = document.querySelectorAll('.add-to-order-btn');
            addToOrderButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const wineId = this.getAttribute('data-wine-id');
                    alert('é¸æŠã—ãŸãƒ¯ã‚¤ãƒ³ã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸã€‚');
                    searchModal.style.display = 'none';
                    // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ã“ã“ã§ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã€è¡¨ã‚’æ›´æ–°ã™ã‚‹å‡¦ç†ã‚’è¡Œã†
                });
            });
            
            // AIææ¡ˆè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³
            const toggleViewBtn = document.getElementById('toggle-view-btn');
            let showOnlyAI = false;
            
            if (toggleViewBtn) {
                toggleViewBtn.addEventListener('click', function() {
                    const rows = document.querySelectorAll('.order-table tbody tr');
                    
                    showOnlyAI = !showOnlyAI;
                    
                    if (showOnlyAI) {
                        this.textContent = 'ğŸ“Š å…¨ã¦è¡¨ç¤º';
                        rows.forEach(row => {
                            const aiSuggested = row.querySelector('.ai-suggestion-badge');
                            if (!aiSuggested) {
                                row.style.display = 'none';
                            }
                        });
                    } else {
                        this.textContent = 'ğŸ¤– AIææ¡ˆã®ã¿è¡¨ç¤º';
                        rows.forEach(row => {
                            row.style.display = '';
                        });
                    }
                });
            }
            
            // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãŠã™ã™ã‚ãƒ¯ã‚¤ãƒ³è¿½åŠ ãƒœã‚¿ãƒ³
            const addToOrderSidebarButtons = document.querySelectorAll('.add-to-order-sidebar');
            addToOrderSidebarButtons.forEach(button => {
                button.addEventListener('click', function() {
                    alert('ãŠã™ã™ã‚ãƒ¯ã‚¤ãƒ³ã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸã€‚');
                    // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ã“ã“ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡Œã‚’è¿½åŠ ã™ã‚‹å‡¦ç†ã‚’è¡Œã†
                });
            });
            
            // åˆæœŸåŒ–æ™‚ã«åˆè¨ˆã‚’æ›´æ–°
            updateOrderTotals();
        });
    </script>
</body>
</html>