<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>カート | ワイサポ - Sommiaがサポートするワインマネジメントシステム</title>
    <link rel="icon" href="../assets/images/favicon.ico">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/components/buttons.css">
    <link rel="stylesheet" href="../css/components/ai_chat.css">
    <link rel="stylesheet" href="../css/components/cards.css">
    <link rel="stylesheet" href="../css/components/tables.css">
    <link rel="stylesheet" href="../css/components/forms.css">
    <link rel="stylesheet" href="../css/pages/my_cellar.css">
    <script defer src="../js/main.js"></script>
    <script defer src="../js/common_parts.js"></script>
    <script defer src="../js/ai_simulator.js"></script>
    <script defer src="../js/utils.js"></script>
</head>
<body>
    <div id="header-placeholder"></div>
    
    <main>
        <div class="container">
            <div class="page-header">
                <h1>カート</h1>
            </div>
            
            <div class="ai-message-container">
                <div id="ai-message-area" class="ai-message">
                    <!-- AIメッセージがここに表示されます -->
                    <img src="../sommia.png" alt="Sommia - ソムリエAI" class="ai-avatar-small">
                    <span class="ai-text">素敵なワインをお選びいただきました！ご注文内容を確認して、お手続きを進めましょう。何かご質問があれば、お気軽にお尋ねくださいね。</span>
                </div>
            </div>
            
            <div class="cart-container">
                <div class="cart-items">
                    <table class="cart-table">
                        <thead>
                            <tr>
                                <th>商品</th>
                                <th>価格</th>
                                <th>数量</th>
                                <th>小計</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="cart-row">
                                <td>
                                    <div class="cart-product">
                                        <div class="wine-color-tag red"></div>
                                        <div class="wine-bottle-placeholder">
                                            <div class="wine-bottle red">
                                                <div class="wine-label-text">キャンティ<br>クラシコ<br>リゼルヴァ</div>
                                            </div>
                                        </div>
                                        <div class="cart-product-info">
                                            <div class="cart-product-name">キャンティ クラシコ リゼルヴァ</div>
                                            <div class="cart-product-meta">イタリア | 赤ワイン</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="cart-price">¥8,000</td>
                                <td>
                                    <div class="cart-quantity">
                                        <button class="cart-quantity-btn decrement">-</button>
                                        <input type="number" class="cart-quantity-input" value="1" min="1" max="99">
                                        <button class="cart-quantity-btn increment">+</button>
                                    </div>
                                </td>
                                <td class="cart-subtotal">¥8,000</td>
                                <td>
                                    <button class="cart-remove-btn">&times;</button>
                                </td>
                            </tr>
                            <tr class="cart-row">
                                <td>
                                    <div class="cart-product">
                                        <div class="wine-color-tag white"></div>
                                        <div class="wine-bottle-placeholder">
                                            <div class="wine-bottle white">
                                                <div class="wine-label-text">ソーヴィニヨン<br>ブラン</div>
                                            </div>
                                        </div>
                                        <div class="cart-product-info">
                                            <div class="cart-product-name">ソーヴィニヨン・ブラン</div>
                                            <div class="cart-product-meta">ニュージーランド | 白ワイン</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="cart-price">¥7,000</td>
                                <td>
                                    <div class="cart-quantity">
                                        <button class="cart-quantity-btn decrement">-</button>
                                        <input type="number" class="cart-quantity-input" value="1" min="1" max="99">
                                        <button class="cart-quantity-btn increment">+</button>
                                    </div>
                                </td>
                                <td class="cart-subtotal">¥7,000</td>
                                <td>
                                    <button class="cart-remove-btn">&times;</button>
                                </td>
                            </tr>
                            <tr class="cart-row">
                                <td>
                                    <div class="cart-product">
                                        <div class="wine-color-tag white"></div>
                                        <div class="wine-bottle-placeholder">
                                            <div class="wine-bottle white">
                                                <div class="wine-label-text">ヴェルメンティーノ<br>2023</div>
                                            </div>
                                        </div>
                                        <div class="cart-product-info">
                                            <div class="cart-product-name">ヴェルメンティーノ 2023</div>
                                            <div class="cart-product-meta">イタリア・サルデーニャ | 白ワイン</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="cart-price">¥6,800</td>
                                <td>
                                    <div class="cart-quantity">
                                        <button class="cart-quantity-btn decrement">-</button>
                                        <input type="number" class="cart-quantity-input" value="6" min="1" max="99">
                                        <button class="cart-quantity-btn increment">+</button>
                                    </div>
                                </td>
                                <td class="cart-subtotal">¥40,800</td>
                                <td>
                                    <button class="cart-remove-btn">&times;</button>
                                </td>
                            </tr>
                            <tr class="cart-row">
                                <td>
                                    <div class="cart-product">
                                        <div class="wine-color-tag red"></div>
                                        <div class="wine-bottle-placeholder">
                                            <div class="wine-bottle red">
                                                <div class="wine-label-text">サンジョヴェーゼ<br>2021</div>
                                            </div>
                                        </div>
                                        <div class="cart-product-info">
                                            <div class="cart-product-name">サンジョヴェーゼ 2021</div>
                                            <div class="cart-product-meta">イタリア・トスカーナ | 赤ワイン</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="cart-price">¥5,200</td>
                                <td>
                                    <div class="cart-quantity">
                                        <button class="cart-quantity-btn decrement">-</button>
                                        <input type="number" class="cart-quantity-input" value="6" min="1" max="99">
                                        <button class="cart-quantity-btn increment">+</button>
                                    </div>
                                </td>
                                <td class="cart-subtotal">¥31,200</td>
                                <td>
                                    <button class="cart-remove-btn">&times;</button>
                                </td>
                            </tr>
                            <tr class="cart-row">
                                <td>
                                    <div class="cart-product">
                                        <div class="wine-color-tag white"></div>
                                        <div class="wine-bottle-placeholder">
                                            <div class="wine-bottle white">
                                                <div class="wine-label-text">アルバリーニョ<br>2023</div>
                                            </div>
                                        </div>
                                        <div class="cart-product-info">
                                            <div class="cart-product-name">アルバリーニョ 2023</div>
                                            <div class="cart-product-meta">スペイン・リアス・バイシャス | 白ワイン</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="cart-price">¥7,500</td>
                                <td>
                                    <div class="cart-quantity">
                                        <button class="cart-quantity-btn decrement">-</button>
                                        <input type="number" class="cart-quantity-input" value="4" min="1" max="99">
                                        <button class="cart-quantity-btn increment">+</button>
                                    </div>
                                </td>
                                <td class="cart-subtotal">¥30,000</td>
                                <td>
                                    <button class="cart-remove-btn">&times;</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="cart-summary">
                    <div class="cart-summary-card">
                        <h3 class="cart-summary-title">注文サマリー</h3>
                        <div class="cart-summary-row">
                            <div class="cart-summary-label">小計</div>
                            <div class="cart-summary-value">¥117,000</div>
                        </div>
                        <div class="cart-summary-row">
                            <div class="cart-summary-label">送料</div>
                            <div class="cart-summary-value">¥0</div>
                        </div>
                        <div class="cart-summary-row cart-summary-total">
                            <div class="cart-summary-label">合計</div>
                            <div class="cart-summary-value">¥117,000</div>
                        </div>
                        <div class="cart-summary-actions">
                            <button class="btn btn-primary btn-block">注文する</button>
                            <a href="products/product_list.html" class="btn btn-outline-secondary btn-block mt-2">ショッピングを続ける</a>
                        </div>
                    </div>
                    
                    <div class="cart-recommendations">
                        <h3 class="recommendations-title">おすすめワイン</h3>
                        <div class="recommendations-items">
                            <div class="recommendation-item">
                                <div class="wine-color-tag sparkling"></div>
                                <div class="wine-bottle-placeholder">
                                    <div class="wine-bottle sparkling">
                                        <div class="wine-label-text">プロセッコ</div>
                                    </div>
                                </div>
                                <div class="recommendation-info">
                                    <div class="recommendation-name">プロセッコ</div>
                                    <div class="recommendation-price">¥6,000</div>
                                    <button class="btn btn-sm btn-outline-primary">カートに追加</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <div id="footer-placeholder"></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 数量の増減ボタン
            const decrementBtns = document.querySelectorAll('.cart-quantity-btn.decrement');
            const incrementBtns = document.querySelectorAll('.cart-quantity-btn.increment');
            
            decrementBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const input = this.nextElementSibling;
                    let value = parseInt(input.value);
                    if (value > 1) {
                        input.value = value - 1;
                        updateCartRow(input);
                    }
                });
            });
            
            incrementBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const input = this.previousElementSibling;
                    let value = parseInt(input.value);
                    if (value < 99) {
                        input.value = value + 1;
                        updateCartRow(input);
                    }
                });
            });
            
            // 数量変更時の更新
            const quantityInputs = document.querySelectorAll('.cart-quantity-input');
            quantityInputs.forEach(input => {
                input.addEventListener('change', function() {
                    let value = parseInt(this.value);
                    if (isNaN(value) || value < 1) {
                        this.value = 1;
                        value = 1;
                    } else if (value > 99) {
                        this.value = 99;
                        value = 99;
                    }
                    updateCartRow(this);
                });
            });
            
            // 削除ボタン
            const removeBtns = document.querySelectorAll('.cart-remove-btn');
            removeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const row = this.closest('.cart-row');
                    row.remove();
                    updateCartTotal();
                });
            });
            
            // おすすめ商品のカート追加ボタン
            const addToCartBtns = document.querySelectorAll('.recommendations-items .btn');
            addToCartBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const item = this.closest('.recommendation-item');
                    const name = item.querySelector('.recommendation-name').textContent;
                    alert(`${name}をカートに追加しました（モックアップのため実際には反映されません）`);
                });
            });
            
            // 注文ボタン
            const orderBtn = document.querySelector('.cart-summary-actions .btn-primary');
            if (orderBtn) {
                orderBtn.addEventListener('click', function() {
                    alert('注文処理を行います（モックアップのため実際には処理されません）');
                });
            }
            
            // カート行の更新
            function updateCartRow(input) {
                const row = input.closest('.cart-row');
                const price = parseFloat(row.querySelector('.cart-price').textContent.replace('¥', '').replace(',', ''));
                const quantity = parseInt(input.value);
                const subtotal = price * quantity;
                
                row.querySelector('.cart-subtotal').textContent = '¥' + subtotal.toLocaleString();
                
                updateCartTotal();
            }
            
            // カート合計の更新
            function updateCartTotal() {
                const subtotals = document.querySelectorAll('.cart-subtotal');
                let total = 0;
                
                subtotals.forEach(el => {
                    total += parseFloat(el.textContent.replace('¥', '').replace(',', ''));
                });
                
                document.querySelector('.cart-summary-row:first-of-type .cart-summary-value').textContent = '¥' + total.toLocaleString();
                document.querySelector('.cart-summary-total .cart-summary-value').textContent = '¥' + total.toLocaleString();
            }
        });
    </script>
    
    <style>
        /* カートページ専用のスタイル */
        .cart-container {
            display: flex;
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }
        
        .cart-items {
            flex: 2;
        }
        
        .cart-summary {
            flex: 1;
        }
        
        /* カートテーブル */
        .cart-table {
            width: 100%;
            margin-bottom: var(--spacing-lg);
        }
        
        .cart-product {
            display: flex;
            align-items: center;
        }
        
        .wine-color-tag {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: var(--spacing-xs);
            flex-shrink: 0;
        }
        
        .wine-color-tag.red {
            background-color: #8B0000;
        }
        
        .wine-color-tag.white {
            background-color: #F0E68C;
        }
        
        .wine-color-tag.rose {
            background-color: #FFB6C1;
        }
        
        .wine-color-tag.sparkling {
            background-color: #F5F5DC;
            border: 1px solid #D4AF37;
        }
        
        /* ワインボトル表示（商品一覧と統一） */
        .wine-bottle-placeholder {
            width: 40px;
            height: 60px;
            margin-right: var(--spacing-sm);
            flex-shrink: 0;
        }
        
        .wine-bottle {
            width: 100%;
            height: 100%;
            border-radius: 8px 8px 4px 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .wine-bottle.red {
            background: linear-gradient(135deg, #8B0000, #A0522D);
            color: #FFD700;
        }
        
        .wine-bottle.white {
            background: linear-gradient(135deg, #F0E68C, #FFFACD);
            color: #4B0082;
        }
        
        .wine-bottle.sparkling {
            background: linear-gradient(135deg, #F5F5DC, #FFE4B5);
            color: #8B4513;
            border: 1px solid #D4AF37;
        }
        
        .wine-bottle.rose {
            background: linear-gradient(135deg, #FFB6C1, #FFC0CB);
            color: #8B008B;
        }
        
        .wine-label-text {
            font-size: 8px;
            font-weight: bold;
            text-align: center;
            line-height: 1.1;
            padding: 2px;
        }
        
        .cart-product-name {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .cart-product-meta {
            font-size: var(--font-size-sm);
            color: #6c757d;
        }
        
        .cart-price, .cart-subtotal {
            font-weight: bold;
        }
        
        /* 数量コントロール */
        .cart-quantity {
            display: flex;
            align-items: center;
            max-width: 120px;
        }
        
        .cart-quantity-input {
            width: 40px;
            text-align: center;
            border: 1px solid var(--medium-gray);
            border-radius: 0;
            height: 32px;
        }
        
        .cart-quantity-btn {
            width: 32px;
            height: 32px;
            background: var(--light-gray);
            border: 1px solid var(--medium-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
        }
        
        .cart-quantity-btn.decrement {
            border-radius: var(--border-radius-sm) 0 0 var(--border-radius-sm);
        }
        
        .cart-quantity-btn.increment {
            border-radius: 0 var(--border-radius-sm) var(--border-radius-sm) 0;
        }
        
        /* 削除ボタン */
        .cart-remove-btn {
            background: none;
            border: none;
            color: #dc3545;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color var(--transition-fast);
        }
        
        .cart-remove-btn:hover {
            color: #bd2130;
        }
        
        /* 注文サマリー */
        .cart-summary-card {
            background-color: var(--white);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-sm);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }
        
        .cart-summary-title {
            margin-bottom: var(--spacing-md);
            color: var(--dark-gray);
            font-size: var(--font-size-lg);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid var(--medium-gray);
        }
        
        .cart-summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-sm);
        }
        
        .cart-summary-total {
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-sm);
            border-top: 1px solid var(--medium-gray);
            font-weight: bold;
            font-size: var(--font-size-lg);
        }
        
        .cart-summary-actions {
            margin-top: var(--spacing-lg);
        }
        
        /* おすすめ商品 */
        .cart-recommendations {
            background-color: var(--white);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-sm);
            padding: var(--spacing-lg);
        }
        
        .recommendations-title {
            margin-bottom: var(--spacing-md);
            color: var(--dark-gray);
            font-size: var(--font-size-lg);
        }
        
        .recommendation-item {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--light-gray);
        }
        
        .recommendation-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .recommendation-info {
            flex: 1;
            margin-left: var(--spacing-sm);
        }
        
        .recommendation-name {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .recommendation-price {
            font-size: var(--font-size-md);
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: var(--spacing-xs);
        }
        
        /* ユーティリティクラス */
        .mt-2 {
            margin-top: var(--spacing-sm);
        }
        
        /* レスポンシブ対応 */
        @media (max-width: 992px) {
            .cart-container {
                flex-direction: column;
            }
            
            .cart-summary {
                display: flex;
                gap: var(--spacing-lg);
            }
            
            .cart-summary-card, .cart-recommendations {
                flex: 1;
            }
        }
        
        @media (max-width: 768px) {
            .cart-summary {
                flex-direction: column;
            }
            
            .cart-table thead {
                display: none;
            }
            
            .cart-table, .cart-table tbody, .cart-table tr, .cart-table td {
                display: block;
                width: 100%;
            }
            
            .cart-row {
                margin-bottom: var(--spacing-md);
                padding-bottom: var(--spacing-md);
                border-bottom: 1px solid var(--medium-gray);
            }
            
            .cart-row td {
                padding: var(--spacing-xs) 0;
                text-align: right;
                position: relative;
                padding-left: 50%;
            }
            
            .cart-row td:before {
                content: attr(data-label);
                position: absolute;
                left: 0;
                width: 45%;
                text-align: left;
                font-weight: bold;
            }
            
            .cart-product {
                justify-content: flex-end;
            }
        }
    </style>
</body>
</html>